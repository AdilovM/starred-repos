import{b as se,c as oe}from"./chunk-QSO2TP3W.js";import{a as me,b as le}from"./chunk-JOCNILL6.js";import{a as F}from"./chunk-N5M54F45.js";import{a as ue,b as de,c as z}from"./chunk-QHRJV7PN.js";import{c as V,d as Y,e as Z}from"./chunk-DQSCGVX4.js";import{a as R}from"./chunk-QZKSC5M6.js";import"./chunk-CWNFCDZO.js";import{a as pe}from"./chunk-WEIWD5Z2.js";import"./chunk-ZMOXJOAW.js";import{a as ie,b as ne}from"./chunk-W365GONS.js";import{a as ae}from"./chunk-U5Q7W6VE.js";import{a as _}from"./chunk-2LV7R6US.js";import"./chunk-YXTYHCVX.js";import{a as te}from"./chunk-POPT6TP2.js";import{b as re}from"./chunk-7MXQG6UX.js";import{d as ee}from"./chunk-JELGMUFY.js";import"./chunk-AQM24QTG.js";import"./chunk-AUHJKPGE.js";import"./chunk-GP57J2CW.js";import{f as K}from"./chunk-DGXX4BQF.js";import{a as W}from"./chunk-HQYWPGUZ.js";import"./chunk-IHTWZOQH.js";import{a as X}from"./chunk-OFY5O3WH.js";import"./chunk-YOWIORHC.js";import"./chunk-62V4AEVH.js";import"./chunk-WDJIMBUZ.js";import"./chunk-ZK4YBVUK.js";import"./chunk-URMVBSCF.js";import"./chunk-CEAYBKHZ.js";import"./chunk-RZQ4QVPP.js";import"./chunk-M3VXQ3H4.js";import{a as H}from"./chunk-SCXJ6RQB.js";import{i as J}from"./chunk-WNVFIGRJ.js";import"./chunk-BYK2LYTJ.js";import"./chunk-SOUDSSPT.js";import"./chunk-YN3ICWDL.js";import{e as j}from"./chunk-JXNVBN57.js";import"./chunk-4JRWSVEX.js";import{b as E,c as u}from"./chunk-FJD4SS3V.js";import"./chunk-TKNWVBCA.js";import{a as A}from"./chunk-V454E5QD.js";import"./chunk-4DDSFSZM.js";import{a as O}from"./chunk-D3V43LVN.js";import"./chunk-M5TAP4VX.js";import"./chunk-X4YGTLGV.js";import"./chunk-BBW4QHNN.js";import"./chunk-CL7MNENB.js";import{a as G}from"./chunk-5ZVMZG6E.js";import"./chunk-33HWVBTX.js";import{a as P,b as U,f as p,g as D,i as I}from"./chunk-ORNWO27Z.js";var r=p(I());var he=p(A());var e=p(I()),T=p(G()),fe=p(A());var C=p(I()),d=p(G()),Q=class extends C.default.Component{onChange(t){let s=t.target.value;this.props.onChange.call(this,s)}render(){return this.props.range.map((t,s)=>[C.default.createElement("label",{key:s,className:"m--r1"},C.default.createElement("input",{type:"radio",name:"TimeseriesRangeSelector",value:t.value,onChange:this.onChange.bind(this),checked:t.value===this.props.currentValue,style:{marginRight:"3px"}})," ",C.default.createElement("span",{className:"type-dim type-small"},t.label))])}};Q.propTypes={onChange:d.default.func.isRequired,currentValue:d.default.string.isRequired,range:d.default.arrayOf(d.default.shape({label:d.default.string.isRequired,value:d.default.string.isRequired})).isRequired};var ce=Q;var xe=e.default.lazy(()=>import("./Export-KFVPQCO7.js")),Ce=fe.default.div`
  background: white;
  border-bottom: 1px solid #e0e0e0;
  position: sticky;
  top: 0;
  z-index: 3;
`,$=({orgId:q,teamId:t,siteId:s,page:n,from:a,metric:i,markers:w,duration:L,onChangeDateRange:N,metricRoute:M,snapshotLink:S,showControls:c})=>{var x,o;let[B,f]=_({triggerOnce:!0}),h={orgId:q,teamId:t,siteId:s,measurements:[i.value],pages:[n],from:a},[b,{loading:k,data:m}]=O(oe,{variables:h});(0,e.useEffect)(()=>{(c||f)&&!m&&b()},[f]);let v=le(h),g=((o=(x=m==null?void 0:m.team)==null?void 0:x.site)==null?void 0:o.timeSeries)||{times:[],series:[],testProfiles:[],metrics:[],loading:!0},y=()=>e.default.createElement(e.default.Fragment,null,!c||e.default.createElement(Ce,{className:"page-section"},e.default.createElement("div",{className:"row middle-xs"},e.default.createElement("div",{className:"col-xs-12 col-sm-4"},e.default.createElement(ce,{onChange:N,currentValue:L,range:[{label:"7 days",value:"7"},{label:"30 days",value:"30"}]})),e.default.createElement("div",{className:"col-xs-12 col-sm-8 center-xs end-sm"},e.default.createElement("div",{className:"type-small","data-qa":"pulse-testProfiles"},e.default.createElement(R,{series:g.series}))))),e.default.createElement("div",{className:"page-section","data-qa":`pulseMetric-${i.value}`},e.default.createElement("div",{className:"m--b3"},e.default.createElement(u,{key:i.name,mb:3},e.default.createElement(E,null,e.default.createElement(u,{flex:1},e.default.createElement(E,{alignItems:"center"},e.default.createElement(u,{mr:"8px"},e.default.createElement(j,{to:M(i.value)},i.label)),e.default.createElement(u,null,e.default.createElement(ee,P({},i))))),e.default.createElement(u,null,e.default.createElement(e.Suspense,{fallback:e.default.createElement("div",null)},e.default.createElement(xe,{id:"pulse.export",actions:[{action:"csv",onClick:v}],values:{site:s,measurement:i.value,from:K(a,"yyyy-MM-dd")}})))),!c&&!f?null:k||g.loading?e.default.createElement(z,{aspectRatio:6},e.default.createElement(u,{position:"relative"},e.default.createElement(ue,{loading:!0}))):e.default.createElement(z,{aspectRatio:6},e.default.createElement(de,{to:new Date,linkTo:(l,ye)=>S(l.snapshot,ye.profile),markers:w,timeSeries:g,formatter:l=>re({number:l,formatter:i.formatter})}))))));return c?e.default.createElement(y,null):e.default.createElement("div",{ref:B},e.default.createElement(y,null))};$.defaultProps={duration:"7",showControls:!0};$.propTypes={duration:T.default.string,onChangeDateRange:T.default.func.isRequired,showControls:T.default.bool};var ge=$;var Me=he.default.div`
  min-height: 100vh;
`,Se=r.default.lazy(()=>import("./CustomisePulseMetrics-KPKDY446.js")),ve=class extends r.default.Component{constructor(t){super(t);D(this,"metricRoute",(t,s)=>{let{teamId:n,siteId:a,childRoute:i}=this.props;return U(P({},i(s)),{pathname:`/teams/${n}/${a}/metrics/${t}`})});D(this,"downloadMetric",(t,s)=>{let{teamId:n,siteId:a,page:i}=this.props;me(t,{teamId:n,siteId:a,measurements:[s],pages:[i],from:this.from})});this.state={hasError:!1,customiseMetrics:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,s){console.error(t,s),X.notify(t)}get from(){let{duration:t}=this.props;return V(new Date,t)}render(){let{orgId:t,teamId:s,siteId:n,page:a,duration:i,onChangeDateRange:w,snapshotLink:L}=this.props,{hasError:N,customiseMetrics:M}=this.state;return N?r.default.createElement(W,null):r.default.createElement(Me,{display:"block"},r.default.createElement(ie,{query:se,variables:{teamId:s,siteId:n,from:this.from}},({data:S,loading:c})=>{var g,y,x;if(!S||c)return null;let{metrics:B=[],currentUser:f,team:h}=S,b={edges:[]},k=[],m,v=[];if(f&&(v=F(f.pulseMetrics)),h){let{site:o}=h;if(m=(x=(y=(g=o==null?void 0:o.pagesList)==null?void 0:g.edges[0])==null?void 0:y.node)==null?void 0:x.uuid,Y(Z(o.createdAt),V(new Date,1))&&!o.hasRecentlyCompletedSnapshots)return null;b=o.deploys,k=o.testProfiles}return M&&r.default.createElement(ne,{mutation:te,onCompleted:()=>this.setState({customiseMetrics:!1})},o=>r.default.createElement(r.Suspense,{fallback:r.default.createElement(H,null)},r.default.createElement(Se,{metrics:F(B),pulseMetrics:v,onCancel:()=>this.setState({customiseMetrics:!1}),onSave:l=>{o({variables:{pulseMetrics:l}})}})))||r.default.createElement(pe,{initialState:k},r.default.createElement("div",{className:"page-section"},r.default.createElement("div",{className:"row middle-xs"},r.default.createElement("div",{className:"col-xs-12 col-sm-4"},r.default.createElement("h3",{className:"type-medium m--b0"},"Metric History")),r.default.createElement("div",{className:"col-xs-12 col-sm-8 center-xs end-sm"},r.default.createElement("div",{className:"type-small"},r.default.createElement(J,{type:"button",onClick:()=>{this.setState({customiseMetrics:!0})}},"Customise"))))),v.map((o,l)=>r.default.createElement(ge,{key:o.value,customise:M,metric:o,showControls:l===0,orgId:t,siteId:n,teamId:s,page:a||m,from:this.from,markers:ae(b),duration:`${i}`,onChangeDateRange:w,snapshotLink:L,onDownloadMetric:this.downloadMetric,metricRoute:this.metricRoute})))}))}},Xe=ve;export{Xe as default};
//# sourceMappingURL=PulseMetrics-IA3KYSO3.js.map
