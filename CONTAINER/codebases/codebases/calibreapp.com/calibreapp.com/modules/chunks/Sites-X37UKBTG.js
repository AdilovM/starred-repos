import{d as q}from"./chunk-HMA44JBL.js";import{a as A}from"./chunk-T3M2VH6O.js";import{a as T}from"./chunk-SJXFQYTK.js";import"./chunk-WEIYGZZI.js";import{a as k}from"./chunk-RZQ4QVPP.js";import{a as N}from"./chunk-UJ4RDOBF.js";import{d as C}from"./chunk-EWS3NXQH.js";import{d as P,j as w}from"./chunk-AQDAG4C2.js";import"./chunk-TT3E6PQD.js";import{a as u}from"./chunk-SCXJ6RQB.js";import{i as z}from"./chunk-WNVFIGRJ.js";import"./chunk-BYK2LYTJ.js";import"./chunk-SOUDSSPT.js";import"./chunk-YN3ICWDL.js";import{c as v}from"./chunk-JXNVBN57.js";import"./chunk-4JRWSVEX.js";import{b as p,c as t}from"./chunk-FJD4SS3V.js";import"./chunk-TKNWVBCA.js";import"./chunk-V454E5QD.js";import"./chunk-4DDSFSZM.js";import{a as I}from"./chunk-I2CW5RII.js";import"./chunk-EHER635N.js";import"./chunk-D3V43LVN.js";import{a as F}from"./chunk-M5TAP4VX.js";import"./chunk-X4YGTLGV.js";import"./chunk-BBW4QHNN.js";import{d as m}from"./chunk-CL7MNENB.js";import"./chunk-5ZVMZG6E.js";import"./chunk-33HWVBTX.js";import{a as l,b as d,f as X,i as Y}from"./chunk-ORNWO27Z.js";var e=X(Y());var Z=e.default.lazy(()=>import("./Pagination-35IAMCGI.js")),R=e.default.lazy(()=>import("./Search-VXTOWKVV.js")),ee=e.default.lazy(()=>import("./Sites-MJ4HRYEQ.js")),te=e.default.lazy(()=>import("./SubscriptionNotification-CWBOP6C6.js")),se=e.default.lazy(()=>import("./Feedback-J4FBAYX2.js")),oe=e.default.lazy(()=>import("./ErrorHandler-AQHEWFNA.js")),ie=e.default.lazy(()=>import("./Welcome-THHNBMLN.js")),ne=e.default.lazy(()=>import("./BlankSlate-DDTKSP2G.js")),re=({match:{params:{teamId:n}}})=>{let{feedback:f,clearFeedback:E}=T(),[g,Q]=(0,e.useState)(!1),[S,_]=(0,e.useState)(""),{currentUser:b,can:s}=I({teamId:n}),[H]=k(q),{data:M,loading:r,fetchMore:O,error:x}=F(A,{variables:{teamId:n,sitesFilter:{nameContains:S}},pollInterval:60*1e3,fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-first"});if((0,e.useEffect)(()=>{!r&&!g&&(Q(!0),H({variables:{session:{team:n}}}))},[r]),x)return e.default.createElement(e.Suspense,{fallback:e.default.createElement("div",null)},e.default.createElement(oe,{error:x}));let{team:h}=M||{},{name:D,organisation:W}=h||{},{slug:y,status:a,trialEndAt:U}=W||{},{slug:j,sitesList:{edges:G,pageInfo:L}}=h||{sitesList:{}},{hasNextPage:$,endCursor:J}=L||{},c=(G||[]).map(({node:i})=>i),K=!r&&!S.length&&c.length===0,V=()=>{O({variables:{cursor:J},updateQuery:(i,{fetchMoreResult:B})=>Object.assign({},i,{team:d(l({},i.team),{bustCache:1,sitesList:d(l({},i.team.sitesList),{edges:[...i.team.sitesList.edges,...B.team.sitesList.edges],pageInfo:B.team.sitesList.pageInfo})})})})},o=[];return["canceled"].includes(a)?o.splice(0,0,s("updateOrganisations")?"plan":"canceled"):["trial_expired","trial_canceled"].includes(a)?o.splice(0,0,s("updateOrganisations")?"trialPlan":"trialCanceled"):(s("createMembers")&&o.splice(0,0,"team"),s("createSites")&&o.splice(0,0,"site")),g?e.default.createElement(e.default.Fragment,null,e.default.createElement(N,{id:"sites.title",breadcrumbs:[D]}),e.default.createElement(w,{variant:"button",flexWrap:["wrap","nowrap"]},e.default.createElement(t,{mb:[4,0],flex:1},e.default.createElement(v,{as:"h1",level:"md"},e.default.createElement(m,{id:"sites.heading"}))),e.default.createElement(t,{flex:1,mb:[4,0]},e.default.createElement(p,{width:1},e.default.createElement(t,{mx:"auto",my:"-5px","data-testid":"sitesSearch"},e.default.createElement(e.Suspense,{fallback:e.default.createElement("div",null)},e.default.createElement(R,{type:"search",onChange:_,placeholder:"Filter sites"}))))),e.default.createElement(t,{flex:["none",1],width:[1,"auto"]},s("createSites")?e.default.createElement(p,null,e.default.createElement(t,{ml:"auto",mr:["auto",0]},e.default.createElement(z,{to:`/teams/${j}/sites/new`,variant:"primary",disabled:["trial_expired","trial_canceled","canceled"].includes(a)},e.default.createElement(m,{id:"sites.actions.new"})))):null)),e.default.createElement(P,{p:void 0},["sites","organisation"].includes(f.location)&&e.default.createElement(se,l({"data-qa":"sitesFeedback",p:null,pt:0,pb:4,duration:0,onDismiss:E},f))||null,r?e.default.createElement(u,null):K?e.default.createElement(e.Suspense,{fallback:e.default.createElement("div",null)},o.length?e.default.createElement(ie,{orgId:y,teamId:n,actions:o}):e.default.createElement(ne,{id:"sites",offsets:[150,150]})):c.length>0?e.default.createElement(e.Suspense,{fallback:e.default.createElement(u,null)},e.default.createElement(te,{status:a,trialEndAt:U,orgId:y,isAdmin:s("readPlan")}),e.default.createElement(ee,{orgId:n,sites:c,initialSortBy:b.summarySortBy,initialSortDirection:b.summarySortDirection}),!$||e.default.createElement(p,null,e.default.createElement(t,{mx:"auto",mt:4,mb:"60px"},e.default.createElement(Z,{pageInfo:L,onNext:V})))):e.default.createElement(t,{textAlign:"center"},e.default.createElement(m,{id:"sites.no_results"})))):e.default.createElement(C,null)},ye=re;export{ye as default};
//# sourceMappingURL=Sites-X37UKBTG.js.map
