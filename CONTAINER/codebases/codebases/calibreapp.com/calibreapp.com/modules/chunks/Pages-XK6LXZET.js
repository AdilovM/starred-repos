import{a as R}from"./chunk-KQFWUF4F.js";import{a as se,b as re,c as ne,d as ie,e as ae,f as pe}from"./chunk-GU7AZSFC.js";import{a as X,b as Y,c as Z}from"./chunk-IHNDKV3B.js";import"./chunk-IGBYPMTC.js";import{a as J}from"./chunk-SJXFQYTK.js";import"./chunk-2FC4P7GA.js";import{a as K}from"./chunk-ECNFHRET.js";import{e as ee,i as oe,j as te}from"./chunk-ZNS7TFW4.js";import"./chunk-RECLXAEN.js";import{a as I}from"./chunk-IHTWZOQH.js";import"./chunk-OFY5O3WH.js";import"./chunk-WEIYGZZI.js";import"./chunk-ECKCXZDJ.js";import{b as V}from"./chunk-5AD3ZUGZ.js";import"./chunk-2OWL4LTV.js";import"./chunk-62V4AEVH.js";import"./chunk-WDJIMBUZ.js";import"./chunk-ZK4YBVUK.js";import"./chunk-URMVBSCF.js";import{a as v}from"./chunk-RZQ4QVPP.js";import"./chunk-M3VXQ3H4.js";import{a as W}from"./chunk-UJ4RDOBF.js";import{d as O}from"./chunk-EWS3NXQH.js";import{d as T}from"./chunk-AQDAG4C2.js";import"./chunk-TT3E6PQD.js";import{h as j,i as G}from"./chunk-WNVFIGRJ.js";import"./chunk-BYK2LYTJ.js";import"./chunk-SOUDSSPT.js";import"./chunk-YN3ICWDL.js";import{c as Q,h as q,i as z}from"./chunk-JXNVBN57.js";import"./chunk-4JRWSVEX.js";import{b as w,c as i}from"./chunk-FJD4SS3V.js";import"./chunk-TKNWVBCA.js";import"./chunk-V454E5QD.js";import"./chunk-4DDSFSZM.js";import{a as _}from"./chunk-M5TAP4VX.js";import"./chunk-X4YGTLGV.js";import"./chunk-BBW4QHNN.js";import{b as A,d}from"./chunk-CL7MNENB.js";import"./chunk-5ZVMZG6E.js";import"./chunk-33HWVBTX.js";import{a as p,b as x,c as $,f as N,i as U}from"./chunk-ORNWO27Z.js";var t=N(U());var e=N(U());var be=({loading:u,teamId:m,siteId:c,pages:r,pageInfo:B,onNext:L,onDelete:k,onUpdatePosition:E,onSearch:F})=>{let b="DELETE",[n,f]=(0,e.useState)(r),h=o=>{if(!o.destination)return;let[a]=n.splice(o.source.index,1);n.splice(o.destination.index,0,a),f(n),E({page:a.uuid,position:o.destination.index+1})};return(0,e.useEffect)(()=>{if(r.length!=n.length)return f(r);r.forEach(o=>{if(!n.find(l=>l.uuid===o.uuid))return f(r)})},[r]),e.default.createElement(e.default.Fragment,null,e.default.createElement(T,{borderBottom:"none"},e.default.createElement(w,{alignItems:"center",flexWrap:["wrap","nowrap"]},e.default.createElement(i,{mr:4,mb:[2,0]},e.default.createElement(Q,{as:"h2",level:"sm"},e.default.createElement(d,{id:"site.settings.pages.title"}))),e.default.createElement(i,{width:[1,270],order:[3,2]},e.default.createElement(d,{id:"site.settings.pages.actions.search"},o=>e.default.createElement(V,{onChange:F,placeholder:o,width:1}))),e.default.createElement(i,{ml:"auto",order:[2,3],mb:[2,0]},e.default.createElement(G,{to:`/teams/${m}/${c}/settings/pages/new`},e.default.createElement(d,{id:"site.settings.pages.actions.add"}))))),n.length?e.default.createElement(pe,{onReorder:h},n.filter(({deleted:o})=>!o).map(({uuid:o,name:a,previewImage:l,url:y},P)=>e.default.createElement(se,{key:o,id:o,index:P},S=>e.default.createElement(e.default.Fragment,null,l?e.default.createElement(re,{name:a,src:l}):null,e.default.createElement(ne,null,e.default.createElement(ae,null,a),e.default.createElement(i,{mb:"8px"},e.default.createElement(j,{href:y,level:"xs"},y)),e.default.createElement(i,null,e.default.createElement(R,{prompt:"Copy UUID",text:o},e.default.createElement(q,{level:"xs"},o)))),e.default.createElement(ie,null,e.default.createElement(i,{mr:4},e.default.createElement(X,p({},S.dragHandleProps))),e.default.createElement(i,null,e.default.createElement(Y,{to:`/teams/${m}/${c}/settings/pages/${o}/edit`})),n.length<=1||e.default.createElement(i,{ml:4},e.default.createElement(d,{id:"site.settings.pages.delete.prompt",values:{confirmText:b}},C=>e.default.createElement(Z,{onClick:()=>{prompt(C)===b&&k({page:o})}})))))))):u?e.default.createElement(T,null,e.default.createElement(O,null)):e.default.createElement(T,null,e.default.createElement(z,null,e.default.createElement(d,{id:"pages.empty"}))),u?null:e.default.createElement(w,null,e.default.createElement(i,{mx:"auto"},e.default.createElement(K,{pageInfo:B,onNext:L}))))},me=be;var he=t.default.lazy(()=>import("./Feedback-J4FBAYX2.js")),ye=t.default.lazy(()=>import("./ErrorHandler-AQHEWFNA.js")),Pe=({match:{params:{teamId:u,siteId:m}}})=>{let{feedback:c,setFeedback:r,clearFeedback:B}=J(),[L,k]=(0,t.useState)(""),E=A(),F={teamId:u,siteId:m,pagesFilter:{nameContains:L},count:20},{loading:b,data:n,fetchMore:f,error:h}=_(ee,{variables:F,fetchPolicy:"cache-and-network"}),{team:o}=n||{},{organisation:a,site:l}=o||{},{name:y,slug:P}=a||{},{name:S,pagesList:C}=l||{},{edges:M,pageInfo:D}=C||{},[ge]=v(oe,{onError:s=>r({location:"pages",type:"error",message:I(s)})}),[le]=v(te,{onCompleted:()=>r({location:"pages",type:"success",message:E.formatMessage({id:"site.settings.pages.delete.success"})}),onError:s=>r({location:"pages",type:"error",message:I(s)})}),de=({page:s})=>le({variables:{orgId:P,siteId:m,uuid:s},optimisticResponse:{__typename:"Mutation",updatePage:{id:s,__typename:"Page",deleted:!0}}}),ue=({page:s,position:g})=>ge({variables:{orgId:P,siteId:m,uuid:s,attributes:{position:g}}}),ce=(M||[]).map(s=>{let H=s.node,{previewImage:g}=H,xe=$(H,["previewImage"]);return x(p({},xe),{previewImage:g?g.url:null})}),fe=()=>{f({variables:{cursor:D.endCursor},updateQuery:(s,{fetchMoreResult:g})=>Object.assign({},s,{team:x(p({},s.team),{bustCache:1,site:x(p({},s.team.site),{pagesList:x(p({},s.team.site.pagesList),{edges:[...s.team.site.pagesList.edges,...g.team.site.pagesList.edges],pageInfo:g.team.site.pagesList.pageInfo})})})})})};return h?t.default.createElement(t.Suspense,null,t.default.createElement(ye,{error:h})):t.default.createElement(t.default.Fragment,null,t.default.createElement(W,{id:"pages.title",breadcrumbs:[S,y]}),c.location==="pages"&&t.default.createElement(t.Suspense,{fallback:t.default.createElement("div",null)},t.default.createElement(he,p({p:0,px:4,pt:4,duration:0,onDismiss:B},c)))||null,t.default.createElement(me,{loading:b,teamId:u,siteId:m,pages:ce,pageInfo:D,onNext:fe,onUpdatePosition:ue,onDelete:de,onSearch:k}))},Qe=Pe;export{Qe as default};
//# sourceMappingURL=Pages-XK6LXZET.js.map
