import{a as rt,f as st,i as at}from"./chunk-FICFKXJL.js";import{a as nt}from"./chunk-SJXFQYTK.js";import{a as q}from"./chunk-IHTWZOQH.js";import"./chunk-OFY5O3WH.js";import"./chunk-WEIYGZZI.js";import{a as N}from"./chunk-RZQ4QVPP.js";import{a as it}from"./chunk-UJ4RDOBF.js";import{d as et}from"./chunk-EWS3NXQH.js";import{d as P,g as _,h as G,i as tt}from"./chunk-AQDAG4C2.js";import"./chunk-TT3E6PQD.js";import{i as E}from"./chunk-WNVFIGRJ.js";import"./chunk-BYK2LYTJ.js";import{H as W,P as Z,R as J,S as K,T as U,U as V,V as X,d as O,e as Q}from"./chunk-SOUDSSPT.js";import"./chunk-YN3ICWDL.js";import{b as j,e as Y,f as R}from"./chunk-JXNVBN57.js";import"./chunk-4JRWSVEX.js";import{b as C,c as a}from"./chunk-FJD4SS3V.js";import"./chunk-TKNWVBCA.js";import"./chunk-V454E5QD.js";import"./chunk-4DDSFSZM.js";import{a as ot}from"./chunk-I2CW5RII.js";import"./chunk-EHER635N.js";import"./chunk-D3V43LVN.js";import{a as A}from"./chunk-M5TAP4VX.js";import"./chunk-X4YGTLGV.js";import"./chunk-BBW4QHNN.js";import{b as L,d as b}from"./chunk-CL7MNENB.js";import"./chunk-5ZVMZG6E.js";import"./chunk-33HWVBTX.js";import{a as f,b as S,c as D,f as z,i as H}from"./chunk-ORNWO27Z.js";var s=z(H());var p=z(H());var t=z(H());var lt=({teamId:l,siteId:n,integrations:h,provider:i,Icon:d,description:x,cta:m,actions:e,onDelete:u})=>{let y=L(),$="DELETE",k=h.map(I=>{var r=I,{events:o}=r,g=D(r,["events"]);return f({eventsDescription:o&&o.length?o.map(w=>y.formatMessage({id:`site.settings.integrations.events.${w}.descriptor`})).join(", "):y.formatMessage({id:"site.settings.integrations.events.empty"}),events:o},g)});return t.default.createElement(_,null,t.default.createElement(G,{span:2},t.default.createElement(a,{border:"1px solid",borderColor:"grey100",borderTopLeftRadius:"3px",borderTopRightRadius:"3px",borderBottomLeftRadius:k.length?0:"3px",borderBottomRightRadius:k.length?0:"3px"},t.default.createElement(C,{p:4,flexWrap:["wrap","nowrap"],alignItems:"center"},d?t.default.createElement(a,{width:[1,"auto"],pr:[0,4],textAlign:"left"},t.default.createElement(d,null)):null,x&&x.url?t.default.createElement(a,{flex:1,my:[3,0]},t.default.createElement(b,{id:`site.settings.integrations.${i}.link`},o=>t.default.createElement(b,{id:`site.settings.integrations.${i}.description`,values:{link:o?t.default.createElement(Y,{href:x.url,target:"_blank"},o):null}},g=>t.default.createElement(j,null,g.map((I,r)=>t.default.createElement("span",{key:r},I)))))):null,m?t.default.createElement(a,{ml:[0,4],width:[1,200]},t.default.createElement(E,S(f({},m),{width:1}),t.default.createElement(b,{id:`site.settings.integrations.${i}.actions.${m.action||"add"}`}))):null)),k.filter(({deleted:o})=>!o).map((w,r)=>{var v=w,{uuid:o,isDisabled:g}=v,I=D(v,["uuid","isDisabled"]);return t.default.createElement(a,{key:o,p:4,border:"1px solid",borderTop:"0px",borderColor:"grey100",borderBottomLeftRadius:r===k.length-1?"3px":0,borderBottomRightRadius:r===k.length-1?"3px":0},t.default.createElement(C,{alignItems:"center"},t.default.createElement(a,{flex:1},t.default.createElement(C,null,t.default.createElement(a,{color:`${g?"red300":"green300"}`,mr:"10px",mt:"3px"},g?t.default.createElement(Q,null):t.default.createElement(O,null)),t.default.createElement(a,{flex:1},t.default.createElement(b,{id:`site.settings.integrations.${i}.integration.${g?"disabled":"enabled"}.description`,values:I},B=>t.default.createElement(j,null,B.map((T,F)=>t.default.createElement("span",{key:F},T))))))),(e==null?void 0:e.includes("edit"))?t.default.createElement(a,{ml:4,mr:2},t.default.createElement(E,{"data-testid":"integration-edit",variant:"tertiary",type:"button",to:`/teams/${l}/${n}/settings/integrations/${i}/${o}/edit`},t.default.createElement(b,{id:"site.settings.actions.edit"}))):null,(e==null?void 0:e.includes("delete"))?t.default.createElement(a,null,t.default.createElement(b,{id:"site.settings.integrations.delete.prompt",values:{confirmText:$}},B=>t.default.createElement(E,{type:"button",variant:"tertiary",onClick:()=>{prompt(B)===$&&u({provider:i,uuid:o})}},t.default.createElement(b,{id:"site.settings.actions.delete"})))):null))})))};lt.defaultProps={integrations:[]};var pt=lt;var mt=({teamId:l,siteId:n,loading:h,integrations:i,onDelete:d})=>{let{features:x}=ot(),m={calibre:{Icon:W,description:{url:"https://calibreapp.com/docs/automation/node"},cta:{target:"_blank",href:"https://github.com/calibreapp/cli/tree/master/examples/nodejs"},actions:["edit","delete"]},github:{Icon:J,description:{url:" https://calibreapp.com/docs/features/pull-request-reviews"},cta:i.find(({provider:e})=>e==="github")?null:{href:`/installations/github/new?state=${l}/${n}`},actions:["edit","delete"]},slack:{Icon:X,description:{url:"https://calibreapp.com/docs/integrations/slack"},cta:{to:`/teams/${l}/${n}/settings/integrations/slack/new`},actions:["edit","delete"]},netlify:{Icon:K,description:{url:"https://calibreapp.com/docs/integrations/netlify"},cta:i.find(({provider:e})=>e==="netlify")?null:{to:`/teams/${l}/${n}/settings/integrations/netlify/new`},actions:["edit","delete"]},webhook:{Icon:V,description:{url:"https://calibreapp.com/docs/integrations/webhooks"},cta:{to:`/teams/${l}/${n}/settings/integrations/webhook/new`},actions:["edit","delete"]},zapier:{Icon:U,description:{url:"https://calibreapp.com/docs/integrations/zapier"},cta:{action:i.find(({provider:e})=>e==="zapier")?"manage":"add",target:"_blank",href:"https://zapier.com/developer/public-invite/145104/27eaface517826df8c41958dab310f30"},feature:"zapier",actions:["delete"]},geckoboard:{Icon:Z,description:{url:"https://calibreapp.com/docs/integrations/geckoboard"},cta:{target:"_blank",href:"https://github.com/calibreapp/geckoboard"},actions:[]}};return p.default.createElement(p.default.Fragment,null,p.default.createElement(P,{borderBottom:"none",p:null,px:4,pt:4},p.default.createElement(tt,{id:"site.settings.integrations"})),p.default.createElement(P,{p:null,px:4,pb:4,pt:3},h?p.default.createElement(_,null,p.default.createElement(G,{span:2},p.default.createElement(et,null))):Object.keys(m).filter(e=>{let u=m[e].feature;return u?x.includes(u):!0}).map(e=>{let u=i.filter(({provider:y})=>y===e);return p.default.createElement(pt,f({key:e,teamId:l,siteId:n,provider:e,integrations:u,onDelete:d},m[e]||{}))})))},dt=mt;var gt=s.default.lazy(()=>import("./Feedback-J4FBAYX2.js")),ct=({match:{params:{teamId:l,siteId:n}}})=>{let h=L(),{feedback:i,setFeedback:d,clearFeedback:x}=nt(),{loading:m,data:e}=A(rt,{variables:{teamId:l,siteId:n},fetchPolicy:"cache-and-network"}),{team:u}=e||{},{organisation:y,site:$}=u||{},{name:k,slug:o}=y||{},{name:g,integrationsList:I,reviewSite:r}=$||{},{edges:w=[]}=I||{},[v]=N(st,{onCompleted:()=>d({location:"integrations",type:"success",message:h.formatMessage({id:"site.settings.integrations.delete.success"},{provider:"GitHub"})}),onError:c=>d({location:"integrations",type:"error",message:q(c)})}),[B]=N(at,{onCompleted:({deleteIntegration:{provider:c}})=>d({location:"integrations",type:"success",message:h.formatMessage({id:"site.settings.integrations.delete.success"},{provider:h.formatMessage({id:`site.settings.integrations.${c}.title`})})}),onError:c=>d({location:"integrations",type:"error",message:q(c)})}),T=({provider:c,uuid:M})=>{c==="github"?v({variables:{orgId:o,siteId:n,uuid:M},optimisticResponse:{__typename:"Mutation",updateGitHub:{id:M,__typename:"ReviewSite",deleted:!0}}}):B({variables:{orgId:o,siteId:n,uuid:M},optimisticResponse:{__typename:"Mutation",updateGitHub:{id:M,__typename:"Integration",deleted:!0}}})},F=w.map(({node:c})=>c);return r&&r.repository&&F.push(S(f({provider:"github"},r),{formattedRepository:s.default.createElement(R,null,r.repository)})),s.default.createElement(s.default.Fragment,null,s.default.createElement(it,{id:"integrations.title",breadcrumbs:[g,k]}),i.location==="integrations"&&s.default.createElement(s.Suspense,{fallback:s.default.createElement("div",null)},s.default.createElement(gt,f({p:0,px:4,pt:4,duration:0,onDismiss:x},i)))||null,s.default.createElement(dt,{loading:m,teamId:l,siteId:n,integrations:F,onDelete:T}))},Dt=ct;export{Dt as default};
//# sourceMappingURL=Integrations-Z6JKWXCW.js.map
