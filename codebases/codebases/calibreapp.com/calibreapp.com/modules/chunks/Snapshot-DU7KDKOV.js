import{a as he}from"./chunk-I3W4UO2E.js";import{a as se}from"./chunk-DNZGOKKR.js";import{a as O,b as ae,d as le,e as me,j as de}from"./chunk-TLNXP4ZF.js";import{a as pe}from"./chunk-H5NVTQ4E.js";import"./chunk-2FC4P7GA.js";import{a as T,b as re}from"./chunk-RQDYQJNL.js";import{a as oe}from"./chunk-ECNFHRET.js";import"./chunk-ZNS7TFW4.js";import{a as ne}from"./chunk-W365GONS.js";import{a as ie}from"./chunk-VSZVUKJA.js";import"./chunk-AUHJKPGE.js";import{a as K}from"./chunk-GP57J2CW.js";import"./chunk-DGXX4BQF.js";import"./chunk-RA7XZ7IG.js";import"./chunk-ECKCXZDJ.js";import{b as ee}from"./chunk-5AD3ZUGZ.js";import{a as Z}from"./chunk-YOWIORHC.js";import{a as R}from"./chunk-2OWL4LTV.js";import"./chunk-62V4AEVH.js";import"./chunk-WDJIMBUZ.js";import"./chunk-ZK4YBVUK.js";import"./chunk-URMVBSCF.js";import"./chunk-CEAYBKHZ.js";import{a as z}from"./chunk-RZQ4QVPP.js";import"./chunk-M3VXQ3H4.js";import{a as te}from"./chunk-UJ4RDOBF.js";import{d as J}from"./chunk-EWS3NXQH.js";import{d as H}from"./chunk-AQDAG4C2.js";import"./chunk-TT3E6PQD.js";import{e as j,h as Y}from"./chunk-WNVFIGRJ.js";import"./chunk-BYK2LYTJ.js";import{b as W,f as $,g as Q}from"./chunk-SOUDSSPT.js";import"./chunk-YN3ICWDL.js";import{b as q}from"./chunk-JXNVBN57.js";import"./chunk-4JRWSVEX.js";import{b as g,c as m}from"./chunk-FJD4SS3V.js";import"./chunk-TKNWVBCA.js";import"./chunk-V454E5QD.js";import{f as M,g as E}from"./chunk-4DDSFSZM.js";import{a as X}from"./chunk-I2CW5RII.js";import"./chunk-EHER635N.js";import"./chunk-D3V43LVN.js";import{a as B}from"./chunk-M5TAP4VX.js";import"./chunk-X4YGTLGV.js";import"./chunk-BBW4QHNN.js";import{d as P}from"./chunk-CL7MNENB.js";import{a as Me}from"./chunk-5ZVMZG6E.js";import"./chunk-33HWVBTX.js";import{a as I,b as k,f,i as N}from"./chunk-ORNWO27Z.js";var t=f(N()),A=f(se());var n=f(N()),ue=f(R());var ce=class extends n.default.Component{constructor(e){super(e);this.state={snapshotsFilter:{},panelIsOpen:!1},this.toggleFilterVisibility=this.toggleFilterVisibility.bind(this),this.handleSnapshotChange=this.handleSnapshotChange.bind(this),this.closeMenu=this.closeMenu.bind(this),this.handleSearch=this.handleSearch.bind(this)}componentDidMount(){document.body.addEventListener("click",this.closeMenu,!1)}componentWillUnmount(){document.body.removeEventListener("click",this.closeMenu)}closeMenu(e){let o=[],s=e.target;for(;s.parentNode;)o.unshift(s.parentNode),s=s.parentNode;o.reverse().some(p=>{if(p.classList)return p.classList.contains("dropdown")})||this.setState({panelIsOpen:!1})}toggleFilterVisibility(){this.setState({panelIsOpen:!this.state.panelIsOpen})}handleSnapshotChange(e){this.setState({snapshotId:e},()=>{this.toggleFilterVisibility(),this.props.onApply.call(this,{snapshotId:this.state.snapshotId})})}handleSearch(e){let o=null,r=/[+-]?\d+(?:\.\d+)?/g.exec(e);r&&r.length&&(o=Number(r[0])),this.setState({snapshotsFilter:{iid:o}})}render(){let{teamId:e,siteId:o,selectedSnapshot:s}=this.props,{snapshotsFilter:r}=this.state,p=(0,ue.default)("dropdown",{"dropdown--isActive":this.state.panelIsOpen});return n.default.createElement("div",{className:p,style:{display:"inline-block"}},n.default.createElement("button",{className:"dropdown__trigger type-semibold type-c-dark-grey  p--l0",onClick:this.toggleFilterVisibility,style:{cursor:"pointer"}},!s||`Snapshot #${s.iid}`,n.default.createElement("div",{className:"dropdown__chevron"},n.default.createElement($,null))),n.default.createElement("div",{className:"dropdown__target"},n.default.createElement("div",{className:"dropdown__header"},n.default.createElement(ee,{placeholder:"Search for snapshot",onChange:this.handleSearch})),n.default.createElement("div",{className:"dropdown__content"},this.state.panelIsOpen&&n.default.createElement(n.Suspense,{fallback:n.default.createElement("div",null)},n.default.createElement(ne,{query:O,variables:{teamId:e,siteId:o,snapshotsFilter:r},fetchPolicy:"network-only"},({loading:S,data:u,fetchMore:c})=>{if(S||!u)return null;let{team:{site:{snapshotsList:{edges:v,pageInfo:d}}}}=u,b=v.map(h=>{let{iid:a}=h.node;return{label:`Snapshot #${a}`,value:a}}),w=()=>{c({variables:{cursor:d.endCursor},updateQuery:(h,{fetchMoreResult:a})=>Object.assign({},h,{team:k(I({},h.team),{bustCache:1,site:k(I({},h.team.site),{snapshotsList:k(I({},h.team.site.snapshotsList),{edges:[...h.team.site.snapshotsList.edges,...a.team.site.snapshotsList.edges],pageInfo:a.team.site.snapshotsList.pageInfo})})})})})};return n.default.createElement("div",{className:"dropdown__list"},b.length&&n.default.createElement(T,{onChange:this.handleSnapshotChange,checked:s.iid,items:b})||n.default.createElement(g,null,n.default.createElement(m,{px:1},n.default.createElement(q,null,n.default.createElement(P,{id:"snapshots.empty"})))),n.default.createElement(g,null,n.default.createElement(m,{mx:"auto"},n.default.createElement(oe,{pageInfo:d,onNext:w}))))})))))}},fe=ce;var y=f(N()),ge=f(R());var ye=class extends y.default.Component{constructor(e,o){super(e,o);this.state={panelIsOpen:!1,profile:this.props.selectedProfile},this.toggleFilterVisibility=this.toggleFilterVisibility.bind(this),this.handleProfileChange=this.handleProfileChange.bind(this),this.closeMenu=this.closeMenu.bind(this)}componentDidMount(){document.body.addEventListener("click",this.closeMenu,!1)}componentWillUnmount(){document.body.removeEventListener("click",this.closeMenu)}closeMenu(e){let o=[],s=e.target;for(;s.parentNode;)o.unshift(s.parentNode),s=s.parentNode;o.reverse().some(p=>{if(p.classList)return p.classList.contains("dropdown")})||this.setState({panelIsOpen:!1})}toggleFilterVisibility(){this.setState({panelIsOpen:!this.state.panelIsOpen})}handleProfileChange(e){this.toggleFilterVisibility(),this.setState({profile:e},()=>{this.props.onApply.call(this,{profile:this.state.profile})})}get activeFilter(){let e=this.props.profiles.find(o=>o.uuid==this.selectedProfile);return e?y.default.createElement("span",null,Z(e.name,25)):null}get selectedProfile(){return this.props.selectedProfile||this.props.profiles[0].uuid}render(){let e=this.props.profiles.map(s=>({label:s.name,value:s.uuid})),o=(0,ge.default)("dropdown",{"dropdown--isActive":this.state.panelIsOpen});return y.default.createElement("div",{className:o,style:{display:"inline-block"}},y.default.createElement("button",{className:"dropdown__trigger type-semibold type-c-dark-grey ",onClick:this.toggleFilterVisibility,style:{cursor:"pointer"}},this.activeFilter,y.default.createElement("div",{className:"dropdown__chevron"},y.default.createElement($,null))),y.default.createElement("div",{className:"dropdown__target"},y.default.createElement("div",{className:"dropdown__content"},y.default.createElement("span",{className:"dropdown__heading"},"Profile"),y.default.createElement(T,{onChange:this.handleProfileChange,checked:this.selectedProfile,items:e}))))}},xe=ye;var C=f(N());var $e=({teamId:l,siteId:e,snapshotId:o,pageUuid:s,profileUuid:r,history:p})=>{let{can:S}=X({teamId:l,siteId:e}),{data:u,loading:c}=B(me,{variables:{teamId:l,siteId:e,snapshotId:o,pageUuid:s,testProfileUuid:r}}),[v]=z(de,{onCompleted:()=>{p.push(`/teams/${l}/${e}/snapshots`)}}),{team:{site:{snapshot:d},organisation:{slug:b}}}=u||{team:{site:{},organisation:{}}},w=()=>{let a=`You are about to delete all tests (all Test Profile and Page combinations) for Snapshot #${o}. If you are sure, type "${o}" below:`;window.prompt(a)==o&&v({variables:{organisation:b,site:e,iid:String(o)},refetchQueries:[{query:O,variables:{teamId:l,siteId:e}}]})},h=[];return d&&d.test&&(d.test.videoUrl&&h.push({action:"video",url:d.test.videoUrl}),d.test.lighthouseUrl&&h.push({action:"lighthouse",url:d.test.lighthouseUrl})),c?null:C.default.createElement(g,null,S("deleteSnapshots")?C.default.createElement(m,{mr:"8px"},C.default.createElement(P,{id:"snapshot.actions.remove"},a=>C.default.createElement(j,{"data-testid":"snapshotDelete",onClick:w,title:a}))):null,C.default.createElement(m,null,C.default.createElement(pe,{id:"snapshot.export",actions:h.map(({action:a,url:L})=>({action:a,onClick:()=>window.open(L,"_blank")})),values:{site:e,snapshot:o}})))},ve=$e;var i=f(N()),Se=f(se());var qe=i.default.lazy(()=>import("./Overview-XIF5HRJI.js")),Te=i.default.lazy(()=>import("./LighthouseContainer-JFC6Z4X4.js")),Oe=i.default.lazy(()=>import("./ThirdParties-SCU2ZLC3.js")),Ve=({teamId:l,siteId:e,snapshotId:o,pageUuid:s,profileUuid:r,url:p})=>{let{loading:S,data:u}=B(le,{variables:{teamId:l,siteId:e,snapshotId:o,pageUuid:s,testProfileUuid:r}}),{team:c}=u||{},{site:v}=c||{},{snapshot:d}=v||{},{test:b}=d||{},{measurements:w}=b||{},h=Se.default.stringify({page:s,profile:r});return i.default.createElement(i.default.Fragment,null,i.default.createElement(he,{path:`/teams/${l}/${e}/snapshots/${o}`,query:h,loading:S,measurements:w}),i.default.createElement(i.default.Fragment,null,i.default.createElement(E,null,i.default.createElement(M,{exact:!0,path:`${p}/`,render:()=>i.default.createElement(i.Suspense,{fallback:i.default.createElement("div",null)},i.default.createElement(qe,{teamId:l,siteId:e,snapshotId:o,pageUuid:s,profileUuid:r}))}),i.default.createElement(M,{exact:!0,path:`${p}/third-parties`,render:a=>i.default.createElement(i.Suspense,{fallback:i.default.createElement("div",null)},i.default.createElement(Oe,I({teamId:l,siteId:e,snapshotId:o,pageUuid:s,profileUuid:r},a)))}),["performance","pwa","best-practices","accessibility","seo"].map(a=>i.default.createElement(M,{key:a,exact:!0,path:`${p}/${a}`,render:L=>i.default.createElement(i.Suspense,{fallback:i.default.createElement("div",null)},i.default.createElement(Te,I({params:{teamId:l,siteId:e,snapshotId:o,page:s,profile:r},reportCategory:a},L)))})))))},be=Ve;var x=f(N()),we=f(Me());var Fe=({status:l})=>x.default.createElement("div",{className:"page-section"},x.default.createElement(g,{alignItems:"center",textAlign:"center"},x.default.createElement(m,{mt:"25vh",mb:3,mx:"auto"},["scheduled","verifying","running","processing"].includes(l)&&x.default.createElement(W,{height:"30px",width:"50px"}))),x.default.createElement(g,{alignItems:"center",textAlign:"center"},x.default.createElement(m,{width:1},x.default.createElement("h2",{className:"type-medium"},x.default.createElement(P,{id:`test.${l}.title`})),x.default.createElement(q,{as:"p",color:"grey300"},x.default.createElement(P,{id:`test.${l}.message`})))));Fe.propTypes={status:we.default.oneOf(["scheduled","running","processing","verifying","failed","not_found"]).isRequired};var U=Fe;var De=t.default.lazy(()=>import("./ErrorHandler-AQHEWFNA.js")),Ge=({match:{params:l,url:e},location:{search:o},history:s})=>{let{teamId:r,siteId:p,snapshotId:S}=l,{page:u,profile:c}=A.default.parse(o),v=({page:Be=u,profile:_e=c,snapshotId:ke=S})=>{s.push({pathname:`/teams/${r}/${p}/snapshots/${ke}`,search:`?${A.default.stringify({page:Be,profile:_e})}`})},d=Number(S),{data:b,loading:w,stopPolling:h,error:a}=B(ae,{variables:{teamId:r,siteId:p,snapshotId:d,page:u,profile:c},pollInterval:5e3});if(w)return t.default.createElement(J,null);if(a)return t.default.createElement(t.Suspense,{fallback:t.default.createElement("div",null)},t.default.createElement(De,{error:a}));let{team:L}=b||{},{organisation:Ie,site:Pe}=L||{},{name:Ce}=Ie||{},{name:Le,snapshot:F,testProfiles:Ne,page:_}=Pe||{},{test:V}=F||{},{status:D}=V||{};(!V||["completed","errored"].includes(D))&&h();let G=[K({prefix:"Created",date:F&&F.createdAt})];return F&&F.ref&&G.push(`Ref: ${F.ref}`),_&&G.push(t.default.createElement(t.default.Fragment,null,t.default.createElement(Y,{key:_.uuid,href:_.url},"View tested page"))),t.default.createElement(t.default.Fragment,null,t.default.createElement(te,{id:"snapshot.title",values:{id:d},breadcrumbs:[Le,Ce]}),t.default.createElement(H,null,t.default.createElement(g,{flexWrap:["wrap","nowrap"],alignItems:"center"},t.default.createElement(m,{flex:1,mb:[4,0]},t.default.createElement(g,{flexWrap:["wrap","nowrap"]},t.default.createElement(m,{fontSize:"20px"},t.default.createElement(fe,{teamId:r,siteId:p,onApply:v,selectedSnapshot:F})),t.default.createElement(m,{mx:2,pt:"3px"},t.default.createElement(Q,{color:"grey300"})),t.default.createElement(m,{fontSize:"20px"},t.default.createElement(re,{teamId:r,siteId:p,onApply:v,selectedPage:_})),t.default.createElement(m,{mx:2,pt:"3px"},t.default.createElement(Q,{color:"grey300"})),t.default.createElement(m,{fontSize:"20px"},t.default.createElement(xe,{onApply:v,selectedProfile:c,profiles:Ne})))),t.default.createElement(m,{width:[1,"auto"],my:"-8px"},t.default.createElement(ve,{teamId:r,siteId:p,snapshotId:d,pageUuid:u,profileUuid:c,history:s}))),t.default.createElement(m,{mt:1},t.default.createElement(ie,{items:G}))),V?["created","scheduled","running","processing","verifying","failed","not_found"].includes(D)?t.default.createElement(U,{status:D}):t.default.createElement(be,{teamId:r,siteId:p,snapshotId:d,pageUuid:u,profileUuid:c,url:e}):t.default.createElement(U,{status:"not_found"}))},qt=Ge;export{qt as default};
//# sourceMappingURL=Snapshot-DU7KDKOV.js.map
