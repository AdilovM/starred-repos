import{a as Ne,g as De,h as Pe}from"./chunk-XXXJE6BZ.js";import{a as Ee}from"./chunk-GPJLMQ4S.js";import{a as Te}from"./chunk-HVWSZP6M.js";import{b as ke,e as Fe,f as we}from"./chunk-IHNDKV3B.js";import{a as Le}from"./chunk-SJXFQYTK.js";import{a as oe}from"./chunk-KCN7NYIH.js";import{a as Me}from"./chunk-YG5VU5UW.js";import{b as Be,c as V,d as z,e as Ce}from"./chunk-DQSCGVX4.js";import"./chunk-CWNFCDZO.js";import{a as he}from"./chunk-ECNFHRET.js";import{a as Ie}from"./chunk-2LV7R6US.js";import{a as Ae,b as $e}from"./chunk-JLSB3ZPE.js";import"./chunk-DGXX4BQF.js";import{a as Q}from"./chunk-IHTWZOQH.js";import"./chunk-OFY5O3WH.js";import"./chunk-WEIYGZZI.js";import{c as ce}from"./chunk-H7BUDTAB.js";import{a as ye}from"./chunk-INK6RNBJ.js";import{b as xe}from"./chunk-5AD3ZUGZ.js";import"./chunk-2OWL4LTV.js";import{a as ve}from"./chunk-WDJIMBUZ.js";import"./chunk-ZK4YBVUK.js";import"./chunk-URMVBSCF.js";import{a as R}from"./chunk-RZQ4QVPP.js";import"./chunk-M3VXQ3H4.js";import{a as Se}from"./chunk-UJ4RDOBF.js";import{d as pe}from"./chunk-EWS3NXQH.js";import{j as ae}from"./chunk-AQDAG4C2.js";import{a as be,b as H,c as B,d as te,e as ue,f as ge}from"./chunk-TT3E6PQD.js";import{a as le,i as de}from"./chunk-WNVFIGRJ.js";import"./chunk-BYK2LYTJ.js";import"./chunk-SOUDSSPT.js";import"./chunk-YN3ICWDL.js";import{b as ee,c as se,f as L}from"./chunk-JXNVBN57.js";import"./chunk-4JRWSVEX.js";import{b as F,c as v}from"./chunk-FJD4SS3V.js";import"./chunk-TKNWVBCA.js";import"./chunk-V454E5QD.js";import"./chunk-4DDSFSZM.js";import{a as fe}from"./chunk-I2CW5RII.js";import"./chunk-EHER635N.js";import"./chunk-D3V43LVN.js";import{a as ie}from"./chunk-M5TAP4VX.js";import"./chunk-X4YGTLGV.js";import"./chunk-BBW4QHNN.js";import{a as me,d as m}from"./chunk-CL7MNENB.js";import"./chunk-5ZVMZG6E.js";import"./chunk-33HWVBTX.js";import{a as h,b as G,f as Z,i as _}from"./chunk-ORNWO27Z.js";var e=Z(_());var s=Z(_());var t=Z(_());var ze=g=>{if(!g)return"";let n=Ce(g),a=new Date(Date.now());return a.setHours(0),a.setMinutes(0),a.setSeconds(0),z(V(a,30),n)?`${Be(n)} ago`:z(V(a,7),n)?"This month":z(V(a,1),n)?"This week":"Today"},Ue=({orgId:g,organisationName:n,uuid:a,displayName:l,state:x,invitationEmail:w,invitationName:p,user:b,role:d,roleLabel:A,stateLabel:y,lastSeenAt:$,isLastAdmin:u,isCurrentMember:c,attributes:N,teamNames:r,shortTeamNames:f,onResendInvite:W,onRemove:J})=>{let[M,O]=Ie({triggerOnce:!1,rootMargin:"50% 0% 50%"}),T=x==="invited",K=d==="member"||!u,j=!(c&&u);return t.default.createElement(H,{key:a,ref:M},O?t.default.createElement(t.default.Fragment,null,t.default.createElement(B,{py:"15px"},t.default.createElement(F,{alignItems:"center"},t.default.createElement(v,{mr:"15px"},t.default.createElement(ce,{size:"medium",name:(b==null?void 0:b.name)||p,url:b==null?void 0:b.avatar,variant:d})),t.default.createElement(v,{alignItems:"center",flex:1,style:{overflow:"hidden"},mr:3},t.default.createElement(ee,null,l),t.default.createElement(ee,{as:"div",level:"xs",color:"grey300"},(b==null?void 0:b.email)||w)))),t.default.createElement(B,{disabled:T},A),N.includes("teamNames")?t.default.createElement(B,{disabled:T},r===f?r:t.default.createElement(ve,{label:r},t.default.createElement(t.default.Fragment,null,f))):null,t.default.createElement(B,{disabled:T},y),t.default.createElement(B,{disabled:T,"data-testid":"member-last-seen-at"},ze($)),t.default.createElement(B,{textAlign:"left",alignItems:"center"},t.default.createElement(F,{justifyContent:"flex-start"},T?t.default.createElement(Fe,{p:"0px",mr:"15px",label:t.default.createElement(m,{id:"memberManagement.actions.reinvite"}),onClick:()=>{W(a)}}):K&&t.default.createElement(ke,{p:"0px",label:t.default.createElement(m,{id:"memberManagement.actions.edit"}),mr:"15px",to:`/organisations/${g}/members/${a}/edit`}),t.default.createElement(t.default.Fragment,null,j&&t.default.createElement(t.default.Fragment,null,t.default.createElement(m,{id:`memberManagement.prompts.${c?"leave":"removeUser"}`,values:{member:l,organisation:n}},X=>t.default.createElement(we,{"data-testid":`remove-${a}`,p:"0px",label:t.default.createElement(m,{id:`memberManagement.actions.${c?"leave":"remove"}`}),onClick:()=>{let D=c?n:l;prompt(X)===D&&J(a)}}))))))):t.default.createElement(B,{colSpan:"5",py:"37px"}))};Ue.defaultProps={attributes:[]};var Oe=Ue;var We=({members:g,pageInfo:n,nextPage:a,orgId:l,currentMemberUuid:x,organisationName:w,onRemove:p,onResendInvite:b})=>{let[d,A]=(0,s.useState)("displayName"),[y,$]=(0,s.useState)("asc"),u=g.slice().sort((r,f)=>{switch(d){case"lastSeenAt":return $e(r[d],f[d],y);default:return Ae(r[d],f[d],y)}}),c=["displayName","roleLabel","teamNames","stateLabel","lastSeenAt"],N=g.filter(({state:r,role:f})=>r==="active"&&f==="admin").length>1;return s.default.createElement(v,{pb:"60px"},s.default.createElement(ge,{bleed:0},s.default.createElement(be,null,s.default.createElement(H,null,c.map(r=>s.default.createElement(te,{key:r,py:"15px",width:`${(100-10)/c.length}%`},s.default.createElement(le,{attribute:r,onUpdateSortBy:A,onUpdateSortDirection:$,sortBy:d,sortDirection:y},s.default.createElement(m,{id:`memberManagement.table.${r}`})))),s.default.createElement(te,{width:"10%",textAlign:"left"},s.default.createElement(m,{id:"memberManagement.table.actions"})))),(u==null?void 0:u.length)?s.default.createElement(ue,null,u.map(r=>s.default.createElement(Oe,h({key:r.uuid,orgId:l,organisationName:w,onRemove:p,onResendInvite:b,isLastAdmin:r.role==="admin"&&!N,isCurrentMember:r.uuid===x,attributes:c},r)))):null),(n==null?void 0:n.hasNextPage)&&s.default.createElement(F,null,s.default.createElement(v,{mx:"auto",mt:4},s.default.createElement(he,{pageInfo:n,onNext:a}))))},je=We;var Je=me(({intl:g,match:{params:{orgId:n}}})=>{let{membership:a}=fe({orgId:n}),{feedback:l,setFeedback:x,clearFeedback:w}=Le(),[p,b]=(0,e.useState)(null),[d,A]=(0,e.useState)(!1),[y,$]=(0,e.useState)([]),[u,c]=(0,e.useState)({totalActiveCount:0,totalInvitedCount:0}),[N,r]=(0,e.useState)(!1),{loading:f,data:W,fetchMore:J}=ie(Ne,{variables:{orgId:n},fetchPolicy:"cache-and-network",onError:o=>{A(!0),x({type:"error",message:Q(o),location:"membersList"})},onCompleted:()=>{A(!0)}}),{organisation:M}=W||{},{activeMembersList:{totalCount:O},invitedMembersList:{totalCount:T},membersList:{edges:K,pageInfo:j}}=M||{activeMembersList:{},invitedMembersList:{},membersList:{}},{endCursor:X}=j||{},{uuid:D}=a||{},[ne]=R(De,{onCompleted:({deleteMember:o})=>{let{uuid:i,user:S,invitationName:C,state:I}=o||{},k=I==="saml";if(i===D)window.location="/home";else{let E=O,U=T,q=y.filter(re=>re.uuid===i?(re.state==="invited"?U-=1:E-=1,!1):!0);c({totalActiveCount:E,totalInvitedCount:U}),$(q),x({type:"success",location:"membersList",message:e.default.createElement(m,{id:`memberManagement.notifications.${k?"samlRemoveSuccess":"removeSuccess"}`,values:{member:e.default.createElement(L,{color:"green400"},(S==null?void 0:S.name)||C,k?"":"\u2018s"),organisation:P}})})}},onError:o=>{x({type:"error",message:Q(o),location:"membersList"})}}),[qe]=R(Pe,{onCompleted:({sendMemberInvite:o})=>{x({type:"success",location:"membersList",message:e.default.createElement(m,{id:"memberManagement.notifications.reinviteSuccess",values:{member:e.default.createElement(L,{color:"green400"},o==null?void 0:o.invitationName)}})})},onError:o=>{x({type:"error",message:Q(o),location:"membersList"})}});(0,e.useEffect)(()=>{if(!f){let o=(K||[]).map(({node:i})=>{var C,I;let S=(i.teams||[]).map(({name:k})=>k);return G(h({},i),{displayName:i.uuid===D?g.formatMessage({id:"currentUser.displayName"}):((C=i.user)==null?void 0:C.name)||i.invitationName,roleLabel:g.formatMessage({id:`memberManagement.label.role.${i.role}`}),stateLabel:g.formatMessage({id:`memberManagement.authentication.label.${((I=i.user)==null?void 0:I.authMethod)||i.state}`}),shortTeamNames:Ee(S),teamNames:S.join(", ")})});$(o),c({totalActiveCount:O,totalInvitedCount:T}),r(p==null?void 0:p.length)}},[f,p]);let Ge=()=>{J({variables:{cursor:X},updateQuery:(o,{fetchMoreResult:i})=>{var S,C,I,k,E,U,q;return Object.assign({},o,{organisation:G(h({},o.organisation),{bustCache:1,membersList:G(h({},(S=o==null?void 0:o.organisation)==null?void 0:S.membersList),{edges:[...(I=(C=o==null?void 0:o.organisation)==null?void 0:C.membersList)==null?void 0:I.edges,...(E=(k=i==null?void 0:i.organisation)==null?void 0:k.membersList)==null?void 0:E.edges],pageInfo:(q=(U=i==null?void 0:i.organisation)==null?void 0:U.membersList)==null?void 0:q.pageInfo})})})}})},He=o=>{ne({variables:{organisation:n,uuid:o}})},Qe=o=>{qe({variables:{organisation:n,uuid:o}})},P=(0,e.useMemo)(()=>M==null?void 0:M.name,[d]),Ve=(0,e.useMemo)(()=>M==null?void 0:M.saml,[d]);if(!d)return e.default.createElement(pe,null);let Y=(p==null?void 0:p.length)?ye(y,p,{keys:["displayName","user.name","user.email","teams","invitationName","invitationEmail","roleLabel","stateLabel"]}):y;return e.default.createElement(e.default.Fragment,null,e.default.createElement(Se,{id:"memberManagement.title",breadcrumbs:[P]}),e.default.createElement(ae,{variant:"button"},e.default.createElement(v,{flex:1,mb:[4,0]},e.default.createElement(Te,null,e.default.createElement(m,{id:"memberManagement.heading",values:{organisation:P}}))),e.default.createElement(v,{pr:1,width:[1,"auto"]},e.default.createElement(de,{to:`/organisations/${n}/members/new`},e.default.createElement(m,{id:"memberManagement.actions.invite",values:{organisation:P}})))),l&&(l.type==="error"||l.type==="info")&&l.location==="membersList"&&e.default.createElement(oe,h({"data-qa":"memberManagementWarningError",p:null,pt:4,px:4,pb:2,duration:0,onDismiss:()=>w()},l)),f?null:e.default.createElement(e.default.Fragment,null,Ve&&e.default.createElement(Me,{m:4,type:"info"},e.default.createElement(m,{id:"memberManagement.notifications.samlInfo"})),e.default.createElement(F,{alignItems:"center",justifyContent:"space-between",mx:4,mt:3},e.default.createElement(se,{as:"h2",level:"sm",color:"grey400"},N?e.default.createElement(m,{id:"memberManagement.memberSummary.filtered",values:{filterCount:e.default.createElement(L,null,Y.length),filterPeople:e.default.createElement(L,null,e.default.createElement(m,{id:`memberManagement.memberSummary.${Y.length===1?"person":"people"}`}))}}):e.default.createElement(m,{id:`memberManagement.memberSummary.${u.totalInvitedCount===0?"members":"membersAndInvites"}`,values:{count:e.default.createElement(L,null,u.totalActiveCount),people:e.default.createElement(L,null,u.totalActiveCount===1?"person":"people"),invitationCount:e.default.createElement(L,null,u.totalInvitedCount),pendingInvitations:e.default.createElement(L,null,e.default.createElement(m,{id:`memberManagement.memberSummary.pendingInvitation${u.totalInvitedCount===1?"":"s"}`}))}})),e.default.createElement(xe,{type:"search",onChange:o=>b((o==null?void 0:o.length)?o:null),placeholder:g.formatMessage({id:"memberManagement.actions.search"}),loading:d?p&&f:!1}))),l&&l.location==="membersList"&&l.type==="success"&&e.default.createElement(oe,h({"data-qa":"memberManagementSuccess",p:null,pt:4,px:4,pb:0,duration:0,onDismiss:()=>w()},l)),e.default.createElement(v,{mx:4,mt:l.location==="membersList"?3:"50px"},e.default.createElement(je,{pageInfo:j,members:Y,orgId:n,currentMemberUuid:D,nextPage:Ge,organisationName:P,onRemove:He,onResendInvite:Qe})))}),At=Je;export{At as default};
//# sourceMappingURL=MemberManagement-HPLNYKYZ.js.map
