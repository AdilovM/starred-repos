import{b as U}from"./chunk-AZF7LUDH.js";import{a as Z}from"./chunk-KCN7NYIH.js";import{a as _}from"./chunk-ECNFHRET.js";import{a as V}from"./chunk-IHTWZOQH.js";import{c as X}from"./chunk-H7BUDTAB.js";import{c as p,e as f}from"./chunk-ECKCXZDJ.js";import{b as Y}from"./chunk-5AD3ZUGZ.js";import{i as v}from"./chunk-WNVFIGRJ.js";import{b as g,f as h}from"./chunk-JXNVBN57.js";import{b as K}from"./chunk-4JRWSVEX.js";import{b as F,c as i}from"./chunk-FJD4SS3V.js";import{a as po}from"./chunk-V454E5QD.js";import{a as W}from"./chunk-D3V43LVN.js";import{b as J,d as r}from"./chunk-CL7MNENB.js";import{a as d,b as y,f as $,i as H}from"./chunk-ORNWO27Z.js";var o=$(H()),R=$(po());var a=$(H());var fo=({displayName:l,role:B,user:m,invitationEmail:b,invitationName:M})=>a.default.createElement(F,{alignItems:"center"},a.default.createElement(i,{mr:"15px"},a.default.createElement(X,{size:"medium",name:(m==null?void 0:m.name)||M,url:m==null?void 0:m.avatar,variant:B})),a.default.createElement(i,{alignItems:"center",flex:1,style:{overflow:"hidden"},mr:3},a.default.createElement(g,{lineHeight:1,as:"div"},a.default.createElement(h,null,l),a.default.createElement("br",null),a.default.createElement(g,{color:"grey400"},(m==null?void 0:m.email)||b)))),P=fo;var D=(0,R.default)(F)`
  background-color: ${({theme:l})=>l.colors.grey50};
  margin-bottom: 10px;
  ${K("background-color")};

  &:hover {
    background-color: ${({theme:l})=>l.colors.green100};
  }

  &:last-child {
    margin-bottom: 0;
  }
`;D.defaultProps={flexWrap:["wrap","nowrap"],bg:"grey50",p:3,alignItems:"center"};var oo=({currentMembershipUuid:l,orgId:B,teamId:m,onUpdate:b,labelId:M,members:S})=>{let eo=J(),[L,to]=(0,o.useState)({}),[s,io]=(0,o.useState)(""),[n,C]=(0,o.useState)(S||[]),[I,G]=(0,o.useState)({loading:!0}),{members:w,searchedOn:N,count:c}=I,[mo,{loading:T,data:q,fetchMore:ro}]=W(U,{fetchPolicy:"cache-and-network",onError:e=>{to({type:"error",message:V(e),location:"membersList"})}}),{organisation:no}=q||{},{membersList:{totalCount:ao,edges:so,pageInfo:x}}=no||{membersList:{}},{endCursor:lo}=x||{};(0,o.useEffect)(()=>{if(s==null?void 0:s.length){G(y(d({},I),{loading:!0}));var e={emailContains:s,OR:{nameContains:s}};m&&(e.NOT={team:[m]}),mo({variables:{orgId:B,filter:e}})}else G({loading:!1,members:[],searchedOn:null})},[s]),(0,o.useEffect)(()=>{if(!T&&q){let e=(so||[]).map(({node:t})=>{var u;return y(d({},t),{displayName:t.uuid===l?eo.formatMessage({id:"currentUser.displayName"}):((u=t.user)==null?void 0:u.name)||t.invitationName})});G({members:e,loading:!1,count:ao,searchedOn:s})}},[T]),(0,o.useEffect)(()=>{S&&C(S)},[S]);let uo=()=>{ro({variables:{cursor:lo},updateQuery:(e,{fetchMoreResult:t})=>{var u,E,O,Q,z,A,j;return Object.assign({},e,{organisation:y(d({},e.organisation),{bustCache:1,membersList:y(d({},(u=e==null?void 0:e.organisation)==null?void 0:u.membersList),{edges:[...(O=(E=e==null?void 0:e.organisation)==null?void 0:E.membersList)==null?void 0:O.edges,...(z=(Q=t==null?void 0:t.organisation)==null?void 0:Q.membersList)==null?void 0:z.edges],pageInfo:(j=(A=t==null?void 0:t.organisation)==null?void 0:A.membersList)==null?void 0:j.pageInfo})})})}})},go=e=>{if(!n.find(t=>t.uuid===e.uuid)){let t=[...n,e];C(t),b&&b(t)}},bo=e=>{let t=n.filter(u=>u.uuid!==e.uuid);C(t),b&&b(t)},k=w==null?void 0:w.filter(e=>!n.find(t=>t.uuid===e.uuid));return o.default.createElement(o.default.Fragment,null,n.length?o.default.createElement(p,{mb:0,"data-testid":"addTeamMemberNewMembers"},o.default.createElement(f,{span:2},o.default.createElement(i,{mb:2},o.default.createElement(g,null,o.default.createElement(r,{id:M,values:{prefix:o.default.createElement(r,{id:`team.members.summary.prefix.${n.length===1?"singular":"plural"}`}),count:o.default.createElement(h,null,n.length," ",o.default.createElement(r,{id:`team.members.summary.${n.length===1?"singular":"plural"}`}))}}))),o.default.createElement("div",null,n.map(e=>o.default.createElement(D,{"data-testid":`newMember-${e.uuid}`,key:e.uuid},o.default.createElement(i,{flex:1,width:[1,"auto"]},o.default.createElement(P,d({},e))),o.default.createElement(i,{mt:[2,0],ml:[0,"100px"],width:[1,"auto"]},o.default.createElement(v,{variant:"tertiary",onClick:()=>bo(e)},o.default.createElement(r,{id:"team.members.add.actions.remove"})))))))):null,o.default.createElement(p,{mb:0},o.default.createElement(f,{span:2,mb:0},o.default.createElement(r,{id:"team.members.add.actions.search"},e=>o.default.createElement(Y,{"data-testid":"teamMemberSearch",width:1,placeholder:e,onChange:t=>io((t==null?void 0:t.length)?t:null),loading:s&&T||!1})))),L&&L.type&&o.default.createElement(p,{mb:0},o.default.createElement(f,{span:2},o.default.createElement(Z,d({"data-qa":"addMembers",p:null,duration:0},L)))),(N==null?void 0:N.length)?(k==null?void 0:k.length)?o.default.createElement(p,{mb:0,mt:"15px","data-testid":"addTeamMemberResults"},o.default.createElement(f,{span:2,mb:0},o.default.createElement(i,{mb:"15px"},o.default.createElement(g,{as:"h3",level:"sm",color:"grey400"},o.default.createElement(r,{id:"team.members.add.found.label",values:{count:o.default.createElement(h,null,c," ",o.default.createElement(r,{id:`team.members.add.found.${c===1?"singular":"plural"}`}))}}))),o.default.createElement("div",null,k.map(e=>o.default.createElement(D,{key:e.uuid},o.default.createElement(i,{flex:1,width:[1,"auto"]},o.default.createElement(P,d({},e))),o.default.createElement(i,{mt:[2,0],ml:[0,"100px"],width:[1,"auto"]},o.default.createElement(v,{onClick:()=>go(e)},o.default.createElement(r,{id:"team.members.add.actions.add"})))))),(x==null?void 0:x.hasNextPage)?o.default.createElement(i,{my:3},o.default.createElement(_,{pageInfo:x,onNext:uo})):null)):o.default.createElement(p,{mt:4,mb:0},o.default.createElement(f,{span:2,mb:0},o.default.createElement(F,{bg:"grey50",p:3,alignItems:"center"},o.default.createElement(i,{flex:1,width:[1,"auto"]},o.default.createElement(g,null,o.default.createElement(r,{id:"team.members.add.notFound",values:{found:w.map(({displayName:e})=>e)}}))),o.default.createElement(i,{mt:[2,0],ml:[0,"100px"],width:[1,"auto"]},o.default.createElement(v,{to:`/organisations/${B}/members/new`},o.default.createElement(r,{id:"team.members.add.actions.invite"})))))):null)};oo.defaultProps={labelId:"team.members.add.selected"};var Po=oo;export{Po as a};
//# sourceMappingURL=chunk-H44VHDU4.js.map
